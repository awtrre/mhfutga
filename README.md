8051 内核智能窗户控制器 (8051-Based Smart Window Controller)
这是一个基于 STC89C52RC 单片机（兼容标准 8051 内核）的智能窗户控制器固件。项目实现了对窗户开合的精准控制，并集成了手动、一键、以及服务于儿童安全与防盗目的的自动感应系统 。


本项目是 “智慧之窗——基于语音控制与太阳能供电的多功能智能窗户” 大学生创新训练项目  的核心功能验证原型。它旨在用精简的硬件平台，验证和实现最关键的电机驱动、位置记忆和安全防盗逻辑。

✨ 主要功能 (Features)
步进电机精准驱动: 使用步进电机控制窗户的开启和关闭，位置由电机运行时间（毫秒）记录，控制精准。
双重控制模式:
手动模式: 用户可通过长按按钮，自由控制窗户的开合程度 。

一键模式: 单击按钮即可让窗户自动完全开启或关闭，操作便捷 。

断电位置记忆: 能够将窗户的当前位置实时保存到单片机内部的 EEPROM (Data-Flash) 中 ，设备重新上电后可恢复到断电前的状态。
智能安全与防盗系统: 集成 HC-SR04 超声波传感器，主动监测窗外情况 。当检测到障碍物或潜在的入侵行为时，系统会自动关闭窗户并发出警报，实现防盗和防儿童坠落的双重保护 。


运动中断: 任何自动或手动的运行过程都可以被新的按键指令随时中断，反应灵敏，保障安全 。
模块化代码: 固件代码结构清晰，将按键、电机、传感器、EEPROM、蜂鸣器等功能解耦到独立的模块中，易于维护和扩展。
硬件清单 (Hardware Requirements)
组件	型号/规格	对应代码模块
微控制器 (MCU)	STC89C52RC 或其他兼容 8051 且带 EEPROM 的 MCU	main.c
电机驱动	5V 步进电机 + ULN2003 驱动板	motor.c
距离传感器	HC-SR04 超声波模块	hcsr04.c
输入按键	4 个轻触按键	buttons.c
声音提示	1 个有源或无源蜂鸣器	buzzer.c
系统时钟	12MHz 晶振	motor.c (延时函数基于此)
📁 代码结构 (Code Structure)
.
├── main.c              # 主程序入口，初始化并调度任务
├── buttons.c/h         # 物理按键的处理逻辑（手动、一键开/关）
├── motor.c/h           # 步进电机驱动（前进、后退、停止）和延时函数
├── onekey.c/h          # "一键"全开/全关及运动中断的核心逻辑
├── hcsr04.c/h          # HC-SR04超声波传感器的数据读取与安全判断
├── eeprom.c/h          # 读写单片机内部EEPROM，用于断电记忆
├── buzzer.c/h          # 蜂鸣器驱动，用于发出警报声
└── run.uvproj          # Keil C51 工程文件
⚙️ 工作原理 (How It Works)
位置追踪: 系统通过一个全局变量 g_position_ms 来记录窗户的当前位置。该变量表示电机从完全关闭状态（0ms）运行到当前状态所需的毫秒数。最大行程由 TOTAL_TIME_MS (10000L) 定义。

按键控制: buttons.c 模块负责检测按键输入 。手动模式下，长按按钮可持续驱动电机 ；一键模式下，onekey.c 模块会分段驱动电机直至完全开启或关闭，此过程可被随时中断 。

断电记忆: 在每次电机停止运动后，eeprom.c 模块会调用 SavePositionToEEPROM() 将当前的 g_position_ms 写入到单片机内部的 EEPROM 扇区 。系统启动时，LoadPositionFromEEPROM() 会从 EEPROM 读回上次保存的位置，实现状态恢复。

安全与防盗逻辑:

该系统的核心安全功能由 hcsr04.c 模块实现，其设计初衷是为了实现项目申报书中提到的“儿童防坠落与防盗双重保护” 。

它通过超声波传感器持续监测窗户附近（20cm内）的物体。为防止误判，只有在连续三次检测到物体后，系统才会确认威胁 。
一旦确认，系统会立即调用 OneKey_Close() 自动关窗，并启动蜂鸣器报警。这一机制既可以防止因孩童靠近窗口而发生的意外，也能在检测到外部伸手等入侵企图时起到有效的防盗作用。
🔧 编译与构建 (Build)
环境: Keil µVision IDE 和 Keil C51 编译器 (PK51)。
步骤:
在 Keil µVision 中打开项目文件 run.uvproj。
选择构建目标 Target 1。
点击 "Project" -> "Build Target" 或按 F7 进行编译。
编译成功后，生成的 HEX 文件位于 .\Objects\run.hex，可直接烧录到目标单片机中 。
⚠️ 关于项目构想与实现的说明

本项目描绘了一个基于 STM32 平台，集成语音控制、太阳能供电和 Wi-Fi 远程控制的完整智能窗户系统 。

当前提供的这份 8051 代码 是该宏大构想下的一个核心功能原型 (Proof of Concept)。它旨在用最精简的硬件平台（STC89C52RC）验证和实现智能窗户最基础、最关键的 电机控制、位置记忆和防盗安全逻辑。这个原型为后续在更强大的 STM32 平台上集成更多高级功能奠定了坚实的底层逻辑和算法基础。
